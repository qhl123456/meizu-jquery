<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/community.css" />
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <header>
      <div class="header">
        <div class="header-left">
          <a href="./index.html">官网</a>
          <a href="">Flyme</a>
          <a href="">专卖店</a>
          <a href="">服务</a>
        </div>
        <div class="header-right">
          <img src="./img/appDownload.png" alt="" />
          APP下载
        </div>
      </div>
    </header>
    <nav>
      <div class="nav">
        <div class="logo">
          <img src="./img/header/logo_b.png" alt="" />
          <span>社区</span>
        </div>
        <div class="menu">
          <a href="">精选</a>
          <a href="">综合讨论</a>
          <a href="">板块</a>
          <a href="">影像馆</a>
          <a href="">魅友家</a>
        </div>
      </div>
      <div class="search">
        <input type="text" placeholder="搜索话题和用户" />
        <button>
          <img src="./img/header/search.jpg" alt="" />
        </button>
      </div>
      <div class="user">
        <a href=""><span class="iconfont">&#xe6a7;</span></a>
      </div>
      <!-- 用户登录列表区 -->
      <div class="user-menu">
        <i class="arrow"></i>
        <ul class="notlogin">
          <li>
            <a href="./login.html"> 立即登录</a>
          </li>
          <li>
            <a href="./register.html"> 立即注册</a>
          </li>
          <li>
            <a href="javascript:;">其他方式登录</a>
          </li>
          <li>
            <a href="javascript:;">
              <img src="./img/footer/19.png" alt="" />
              <img src="./img/footer/17.png" alt="" />
            </a>
          </li>
        </ul>
        <ul class="login">
          <li><a href="javascript:;">我的账户</a></li>
          <li class="login-mine">
            <a href="javascript:;">我的动态</a>
          </li>
          <li><a href="javascript:;">我的帖子</a></li>
          <li><a href="javascript:;">我的好友</a></li>
          <li><a href="javascript:;">我的消息</a></li>
          <li><a href="javascript:;">个人设置</a></li>
          <li class="last-child login-mine">
            <a href="javascript:;">退出账户</a>
          </li>
        </ul>
      </div>
      <main class="post-main">
        <section class="post-left-side">
          <!-- 内容区 -->
          <div class="post-container">
            <!-- 返回顶部 -->
            <div class="side-bar">
              <div class="side-item">
                <i class="icon-support "></i>
                <span class="fadeIn">点赞</span>
              </div>
              <div class="side-item">
                <i class="icon-comment "></i>
                <span class="fadeIn">评论</span>
              </div>
              <div class="side-item">
                <i class="icon-collect "></i>
                <span class="fadeIn">收藏</span>
              </div>
              <div class="side-item">
                <i class="icon-back "></i>
                <span class="fadeIn">返回顶部</span>
              </div>
            </div>
            <div class="post-top">
              <!-- 面包屑导航 -->
              <div class="bread-crumb">
                <a href="./index.html" class="first">首页</a>
                >
                <a href="./community.html">综合讨论</a>
              </div>
              <!-- title -->
              <h1 class="post-title line-ellipsis">
              </h1>
              <!-- 作者信息 -->
              <div class="post-author">
                <div class="post-author-info">
                  <!-- 楼主信息 -->
                  <dl>
                    <dt>
                      <a href="javascript:;">
                        <img src="" alt="" />
                      </a>
                    </dt>
                    <dd>
                      <div class="post-author-name">
                        <a href="javascript:;"></a>
                        <i class="vip"></i>
                        <span>魅友公摄组</span>
                      </div>
                      <div class="post-mess">
                        <span>楼主</span>
                        <span class="post-date">03月07日</span>
                      </div>
                    </dd>
                  </dl>
                  <!--icon区域  -->
                  <div class="post-mess-menu">
                    <div class="post-mess-menu-item">
                      <span class="share-ico"></span>
                    </div>
                    <div class="post-mess-menu-item">
                      <span class="collect-ico"></span>
                    </div>
                    <div class="post-mess-menu-item">
                      <span class="action-ico"></span>
                    </div>
                  </div>
                  <!-- 评分区域 -->
                  <div class="post-mess-info">
                    <span class="rate-btn">评分：</span>
                    <span class="post-mess-value rate-btn">881</span>
                    <span>评论：</span>
                    <span class="post-mess-value">450</span>
                    <span>阅读：</span>
                    <span class="post-mess-value last">2.75万</span>
                  </div>
                </div>
              </div>
              <!-- 内容区 -->
              <div class="user-content">
                <i class="pstatus"> </i>
                <p class="desc"></p>
              </div>
              <!-- 底部区域 -->
              <div class="post-footer">
                <div class="footer-left">
                  <p class="hot-people">
                    <a href="javascript:;"
                      >用户3201832&nbsp;&nbsp;&nbsp;&nbsp;</a
                    >
                    <a href="javascript:;">Keicy520&nbsp;&nbsp;&nbsp;&nbsp;</a>
                    等人参与讨论
                  </p>
                </div>
                <div class="footer-right">
                  <div class="ico-item support">
                    <i class="support-ico">
                     
                    </i>
                    <span>277</span>
                  </div>
                  <div class="ico-item against">
                    <i class="against-ico"></i>
                    <span>22</span>
                  </div>
                </div>
              </div>
              <!-- 评论区 -->
              <div id="replyEditorWrapper">
                <div class="editor">
                  <div class="content-outter">
                    <div class="content"></div>
                    <input class="placeholder" placeholder="我来说两句..."></input>
                    <a href="javascript:;" class="reply-btn"> </a>
                    <div class="emoji-wrapper">
                      <div class="emoji"></div>
                    </div>
                    <div class="reply-uploader" style="float: right">
                      <div class="img-uploader"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="post-right-side">
          <!-- 用户信息 -->
          <div class="author-info">
            <div class="author-info-avatar">
              <a href="javascript:;">
                <img src="" />
              </a>
            </div>
            <div class="author-info-name">
              <a href="javascript:;"></a>
              <i class="vip"></i>
            </div>
            <div class="author-info-level">魅友公摄组</div>
            <div class="author-info-care">
              <a href="javascript:;" class="careUser">关注</a>
            </div>
          </div>
          <!-- 评论区 -->
          <div class="dynamic">
            <div class="dynamic-title">
              <a href="javascript:;">更多</a>
              <span>TA的评论</span>
            </div>
            <ul class="dynamic-list">
              <li class="dynamic-item">
                <div class="dynamic-name">
                  <a href="javascript:;">  </a>
                </div>
                <div class="dynamic-info">
                  <span></span>
                  <span>魅族社区</span>
                </div>
                <div class="dynamic-content">
                  <a href="javascript:;" style="color: #222; font-weight: 400">
                  </a>
                </div>
                <div class="dynamic-img-share">
                  <a href="jacascript:;">
                    <div class="left">
                      <img src="" />
                    </div>
                    <div class="right">
                      <span></span>
                    </div>
                  </a>
                </div>
              </li>
            </ul>
          </div>
        </section>
      </main>
    </nav>
  </body>
</html>
<script src="./js/jQuery.js"></script>
<script src="./js/community.js"></script>
<script>
  $(function(){
    function getUrlParam(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      if (pair[0] == variable) {
        return pair[1];
      }
    }
    return false;
  }
    let goodsId = getUrlParam("goodsId");
    let vipName = localStorage.getItem('username')
    $.ajax({
      url:'./getComment.php',
      method:'get',
      data:{goodsId,pagecount:10,pageIndex:1},
      success(res){
        getCommentData(JSON.parse(res))
      }
    })
    function getCommentData(res){
      console.log(res);
      for(let i =0;i<res.length;i++){
        let lis = $('<li></li>').addClass('dynamic-item').appendTo($('.dynamic-list'))
        lis.html(`
        <div class="dynamic-name">
                  <a href="javascript:;"> ${res[i].vipName} </a>
                </div>
                <div class="dynamic-info">
                  <span>${res[i].commentTime}</span>
                  <span>魅族社区</span>
                </div>
                <div class="dynamic-content">
                  <a href="javascript:;" style="color: #222; font-weight: 400">
                    ${res[i].content}
                  </a>
                </div>
                <div class="dynamic-img-share">
                  <a href="jacascript:;">
                    <div class="left">
                      <img src="${res[i].commentImg.substring(3)}" />
                    </div>
                    <div class="right">
                      <span>${res[i].commentContent}</span>
                    </div>
                  </a>
                </div>
        `)
      }
    }

    $.ajax({
    url:'./getGoodsInfo.php',
    method:'get',
    data:{goodsId,},
    success(res){
      getData(JSON.parse(res))
    }
  })
  function getData(res){
    console.log(res);
    $("title").html(res.goodsTitle)
    $('.post-title').html(res.goodsTitle)
    $('.post-author-name a').html(res.goodsName)
    $('dt a img').attr('src',res.goodsInfoImg.substring(3))
    $('.author-info-avatar a img').attr('src',res.goodsInfoImg.substring(3))
    $('.author-info-name a').html(res.goodsName)
    $('.pstatus').html(`本帖最后由${res.goodsName} 于 2021-03-09 10:56 编辑 `)
    $('.desc').html(res.goodsDesc)
    $('.dynamic-img-share .left>img').attr('src',res.goodsImg.substring(3))
    $('.dynamic-img-share .right>span').html(res.goodsTitle+'美图分享')
    let imgs = res.goodsBanner.split(' ')
    for(let i =0;i<imgs.length;i++){
     let img =  $('<img src = "" />').addClass('content-imgs').appendTo($('.user-content'))
     img.attr('src',imgs[i])
    }
  }
  

    $(".reply-btn").click(() => {
    $.ajax({
      url:'./addComment.php',
      method:'post',
      data:{vipName,goodsId,content:$('.placeholder').val()},
      success(res){
       if(res=='success'){
         window.location.reload()
       }
      }
    })
  });
})
</script>